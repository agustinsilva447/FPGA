#include <xparameters.h>
#include <xtime_l.h>
#include <stdlib.h>
#include <stdio.h>
#include <math.h>
#include <time.h>

#include "xnqueens_hw.h"
#include "xil_printf.h"
#include "xnqueens.h"
#include "sleep.h"

#define n 8

int main()
{
	XTime tStart;
	XTime tEnd;
	int a_hw[n], u_0_hw = 1, k_hw = 0, sol_list_hw = 0, iteration_hw = 1, flag_hw = 0;
	float time_hw;
	int status;

	XNqueens goNqueens;
	XNqueens_Config *goNqueens_cfg;
	goNqueens_cfg = XNqueens_LookupConfig(XPAR_NQUEENS_0_DEVICE_ID);
	if (!goNqueens_cfg){
		printf("\nError cargando la configuracion de goNqueens.");
	} else {
		printf("\nNqueens configurado correctamente.");
	}
	status = XNqueens_CfgInitialize(&goNqueens, goNqueens_cfg);
	if (status != XST_SUCCESS){
		printf("\nError inicializando goNqueens.");
	} else {
		printf("\nNqueens inicializado correctamente.");
	}
	XNqueens_Initialize(&goNqueens, XPAR_NQUEENS_0_DEVICE_ID);

	for (int x=0; x<n; x++){
		a_hw[x] = 0;
	}
	XNqueens_Write_a_Words(&goNqueens, 0, a_hw, n);
	XNqueens_Set_k_i(&goNqueens, k_hw);
	XNqueens_Set_u_0_i(&goNqueens, u_0_hw);
	XNqueens_Set_sol_list_i(&goNqueens, sol_list_hw);
	XNqueens_Start(&goNqueens);

	XTime_GetTime(&tStart);
	while ((!flag_hw) && (iteration_hw < 100)){
		while(!XNqueens_IsDone(&goNqueens));
		//XNqueens_Read_a_Words(&goNqueens, 0, a_hw, n);
		//k_hw = XNqueens_Get_k_i(&goNqueens);
		//u_0_hw = XNqueens_Get_u_0_i(&goNqueens);
		//sol_list_hw = XNqueens_Get_sol_list_i(&goNqueens);
		flag_hw = XNqueens_Get_flag(&goNqueens);
		iteration_hw = iteration_hw + 1;
	}
	XTime_GetTime(&tEnd);
	time_hw = (float)((tEnd - tStart));
	printf("\nHARDWARE ---> Number of solutions for %d queens: %d. Execution time: %f mseg.\n", n, sol_list_hw, time_hw/(COUNTS_PER_SECOND/1000));
	return 0;
}
